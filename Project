using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.InputSystem;

public class Doodlik : MonoBehaviour
{
	public new Rigidbody2D rigidbody;
    public float jumpForce;
    public float speed;
    
    private Keyboard keyboard;
    private bool canJump = true;
    private float jumpCooldown = 0.2f;
    private bool facingRight = true;

    private void Start()
    {
        keyboard = Keyboard.current;
    }

    private void Update()
    {
        if (keyboard.aKey.isPressed)
        {
            transform.Translate(Vector2.left * speed * Time.deltaTime);
            if (facingRight)
	    {
                Flip(false);
            }
        }
        
        if (keyboard.dKey.isPressed)
        {
            transform.Translate(Vector2.right * speed * Time.deltaTime);
            if (!facingRight)
            {
                Flip(true);
            }
        }
    }

    private void Flip(bool faceRight)
    {
      
        facingRight = faceRight;

        Vector3 theScale = transform.localScale;

      
        if (faceRight)
        {
            theScale.x = Mathf.Abs(theScale.x);
        }
        else
        {
            theScale.x = -Mathf.Abs(theScale.x);
        }

        transform.localScale = theScale;
    }

    private void OnCollisionEnter2D(Collision2D collision)
    {
        if (canJump && IsCollisionFromBelow(collision))
        {
            StartCoroutine(JumpWithCooldown());
        }
    }

    private bool IsCollisionFromBelow(Collision2D collision)
    {
        foreach (ContactPoint2D contact in collision.contacts)
        {
            if (contact.normal.y > 0.5f)
            {
                return true;
            }
        }
        return false;
    }

    private System.Collections.IEnumerator JumpWithCooldown()
    {
        canJump = false;
        
        rigidbody.linearVelocity = new Vector2(rigidbody.linearVelocity.x, 0);
        
        rigidbody.AddForce(Vector2.up * jumpForce, ForceMode2D.Impulse);
        
        yield return new WaitForSeconds(jumpCooldown);
        
        canJump = true;
    }
}
